package i18n

import (
	"fmt"
	"strings"
)

// Translations holds all translations
var translations = map[string]map[string]string{
	"en": englishTranslations,
	"cs": czechTranslations,
}

// AvailableLanguages returns all available languages
var AvailableLanguages = map[string]string{
	"en": "English",
	"cs": "Čeština",
}

// Init initializes the i18n system
func Init() error {
	// Translations are already loaded as variables
	return nil
}

// T translates a key to the specified language
func T(lang, key string, args ...interface{}) string {
	// Get language translations
	langTranslations, ok := translations[lang]
	if !ok {
		langTranslations = translations["en"]
	}

	// Get translation
	text, ok := langTranslations[key]
	if !ok {
		// Fallback to English
		text, ok = translations["en"][key]
		if !ok {
			return key // Return key if not found
		}
	}

	// Replace placeholders
	if len(args) > 0 {
		// Support both {0}, {1} style and {name} style
		for i, arg := range args {
			placeholder := fmt.Sprintf("{%d}", i)
			text = strings.ReplaceAll(text, placeholder, fmt.Sprint(arg))
		}
	}

	return text
}

// IsValidLanguage checks if a language is supported
func IsValidLanguage(lang string) bool {
	_, ok := translations[lang]
	return ok
}

// GetLanguages returns available languages
func GetLanguages() map[string]string {
	return AvailableLanguages
}

// English translations
var englishTranslations = map[string]string{
	// General
	"app_name":     "CPM - Caddy Proxy Manager",
	"app_version":  "Version",
	"save":         "Save",
	"cancel":       "Cancel",
	"delete":       "Delete",
	"edit":         "Edit",
	"create":       "Create",
	"back":         "Back",
	"search":       "Search",
	"filter":       "Filter",
	"loading":      "Loading...",
	"success":      "Success",
	"error":        "Error",
	"warning":      "Warning",
	"confirm":      "Confirm",
	"yes":          "Yes",
	"no":           "No",
	"actions":      "Actions",
	"settings":     "Settings",
	"logout":       "Logout",
	"status":       "Status",
	"domain":       "Domain",
	"modified":     "Modified",
	"more":         "more",
	"rules":        "rules",
	"days":         "days",
	"today":        "Today",
	"never":        "Never",
	"not_set":      "Not set",
	"about":        "About",
	"build_date":   "Build Date",
	"about_description": "Web interface for managing Caddy reverse proxy.",
	"valid_from":   "Valid From",
	"auto_scroll":  "Auto-scroll",
	"username":     "Username",
	"password":     "Password",
	"role":         "Role",
	"created":      "Created",
	"last_login":   "Last Login",

	// Navigation
	"nav_dashboard":    "Dashboard",
	"nav_sites":        "Proxy Rules",
	"nav_snippets":     "Snippets",
	"nav_certificates": "Certificates",
	"nav_logs":         "Logs",
	"nav_settings":     "Settings",

	// Dashboard
	"dashboard_title":          "Dashboard",
	"dashboard_rules":          "Rules",
	"dashboard_certificates":   "Certificates",
	"dashboard_snippets":       "Snippets",
	"dashboard_caddy_status":   "Caddy Status",
	"dashboard_running":        "Running",
	"dashboard_stopped":        "Stopped",
	"dashboard_recent_changes": "Recent Changes",
	"dashboard_no_changes":     "No recent changes",
	"dashboard_alerts":         "Alerts",
	"dashboard_no_alerts":      "All systems operational",
	"dashboard_quick_actions":  "Quick Actions",
	"dashboard_reload":         "Reload Caddy",
	"dashboard_validate":       "Validate Config",
	"dashboard_new_rule":       "New Rule",
	"dashboard_backup":         "Backup",

	// Sites
	"sites_title":            "Proxy Rules",
	"sites_new":              "New Rule",
	"sites_edit":             "Edit Rule",
	"sites_delete":           "Delete Rule",
	"sites_duplicate":        "Duplicate Rule",
	"sites_empty":            "No proxy rules found",
	"sites_empty_title":      "No Proxy Rules",
	"sites_empty_desc":       "Create your first proxy rule to get started.",
	"sites_create":           "Create Rule",
	"sites_search":           "Search domains, IP, port...",
	"sites_filter_tag":       "Filter by tag",
	"sites_all_tags":         "All tags",
	"sites_domain":           "Domain(s)",
	"sites_target":           "Target",
	"sites_port":             "Port",
	"sites_ip":               "IP Address",
	"sites_https_backend":    "HTTPS Backend",
	"sites_internal":         "Internal Only",
	"sites_websocket":        "WebSocket Support",
	"sites_health_check":     "Health Check Path",
	"sites_timeout":          "Timeout (seconds)",
	"sites_snippets":         "Snippets",
	"sites_tags":             "Tags",
	"sites_extra_config":     "Extra Configuration",
	"sites_raw_edit":         "Raw Edit",
	"sites_form_edit":        "Form Edit",
	"sites_preview":          "Preview",
	"sites_confirm_delete":   "Are you sure you want to delete this rule?",
	"sites_created":          "Rule created successfully",
	"sites_updated":          "Rule updated successfully",
	"sites_deleted":          "Rule deleted successfully",
	"sites_duplicated":       "Rule duplicated successfully",
	"sites_from_template":    "From Template",
	"sites_from_scratch":     "From Scratch",
	"sites_select_template":  "Select Template",
	"sites_template_category": "Category",
	"domain_config":          "Domain Configuration",
	"backend_target":         "Backend Target",
	"domains_hint":           "Separate multiple domains with comma or space",
	"tags_hint":              "Organize rules with comma-separated tags",
	"advanced_options":       "Advanced Options",
	"extra_config_placeholder": "Additional Caddy directives...",

	// Snippets
	"snippets_title":              "Snippets Manager",
	"snippets_description":        "Configure reusable Caddy snippets that can be imported into proxy rules.",
	"snippets_cloudflare":         "Cloudflare DNS",
	"snippets_internal":           "Internal Only",
	"snippets_security":           "Security Headers",
	"snippets_compression":        "Compression",
	"snippets_rate_limit":         "Rate Limit",
	"snippets_basic_auth":         "Basic Authentication",
	"snippets_enabled":            "Enabled",
	"snippets_disabled":           "Disabled",
	"snippets_enable_cloudflare":  "Enable Cloudflare DNS Challenge",
	"snippets_enable_internal":    "Enable Internal Network Restriction",
	"snippets_enable_security":    "Enable Security Headers",
	"snippets_enable_compression": "Enable Compression",
	"snippets_enable_rate_limit":  "Enable Rate Limiting",
	"snippets_use_env":            "Use CF_API_TOKEN environment variable",
	"snippets_api_token":          "API Token (if not using env)",
	"snippets_api_token_placeholder": "Enter Cloudflare API token",
	"snippets_allowed_networks":   "Allowed Networks (CIDR)",
	"snippets_networks_help":      "One network per line in CIDR notation",
	"snippets_hsts_max_age":       "HSTS Max Age (seconds)",
	"snippets_include_subdomains": "Include Subdomains",
	"snippets_x_frame_options":    "X-Frame-Options",
	"snippets_referrer_policy":    "Referrer Policy",
	"snippets_hide_server":        "Hide Server Header",
	"snippets_zstd":               "Zstd",
	"snippets_gzip":               "Gzip",
	"snippets_requests":           "Requests",
	"snippets_window":             "Window (seconds)",
	"snippets_users":              "Users",
	"snippets_add_user":           "Add User",
	"snippets_username":           "Username",
	"snippets_password":           "Password",

	// Certificates
	"certs_title":          "SSL Certificates",
	"certs_count":          "certificates",
	"certs_domain":         "Domain",
	"certs_issuer":         "Issuer",
	"certs_expires":        "Expires",
	"certs_status":         "Status",
	"certs_days_left":      "Days Left",
	"certs_valid":          "Valid",
	"certs_expiring":       "Expiring (30d)",
	"certs_critical":       "Critical (7d)",
	"certs_expired":        "Expired",
	"certs_delete":         "Force Renewal",
	"certs_force_renew":    "Force Renew",
	"certs_confirm_delete": "Delete certificate to force renewal for",
	"certs_empty":          "No certificates found",
	"certs_empty_title":    "No Certificates Found",
	"certs_empty_desc":     "Certificates will appear here once Caddy obtains them.",
	"certs_about_title":    "About Certificate Renewal",
	"certs_about_desc":     "Caddy automatically renews certificates before they expire. Use \"Force Renew\" only if you need to manually trigger renewal (e.g., after changing DNS settings).",

	// Logs
	"logs_title":   "Caddy Logs",
	"logs_lines":   "Lines",
	"logs_refresh": "Refresh",
	"logs_search":  "Search logs...",
	"logs_stream":  "Live Stream",
	"logs_stop":    "Stop Stream",
	"logs_empty":   "No logs available",

	// Settings
	"settings_title":          "Settings",
	"settings_general":        "General",
	"settings_backup":         "Backup",
	"settings_caddy":          "Caddy",
	"settings_users":          "Users",
	"settings_language":       "Language",
	"settings_theme":          "Theme",
	"backup_restore":          "Backup & Restore",
	"backup_description":      "Create or restore a complete backup of your Caddy configuration.",
	"backup_create":           "Create Backup",
	"backup_create_desc":      "Download a ZIP file with all configuration files.",
	"backup_download":         "Download Backup",
	"backup_restore_title":    "Restore Backup",
	"backup_restore_desc":     "Upload a backup ZIP file to restore configuration.",
	"backup_upload":           "Restore Backup",
	"import_export":           "Import / Export Rules",
	"import_export_desc":      "Export rules as JSON or import from another CPM instance.",
	"export_rules":            "Export Rules",
	"export_rules_desc":       "Download all proxy rules as JSON file.",
	"export_json":             "Export JSON",
	"import_rules":            "Import Rules",
	"import_rules_desc":       "Import rules from a JSON file.",
	"import_upload":           "Import Rules",
	"skip_existing":           "Skip existing rules",
	"fallback_rule":           "Fallback Rule",
	"fallback_description":    "Default rule for unknown domains (wildcard).",
	"fallback_not_found":      "Fallback rule not found.",
	"error_pages":             "Error Pages",
	"error_pages_description": "Custom HTML pages for error responses.",
	"user_management":         "User Management",
	"enable_auth":             "Enable Authentication",
	"auth_disabled_warning":   "Authentication is disabled. Anyone can access the application.",
	"no_users_warning":        "No users created yet. Create at least one user to enable authentication.",
	"existing_users":          "Existing Users",
	"add_user":                "Add New User",
	"create_user":             "Create User",
	"confirm_delete_user":     "Delete user",
	"settings_backup_create":  "Create Backup",
	"settings_backup_restore": "Restore Backup",
	"settings_import":         "Import Rules",
	"settings_export":         "Export Rules",
	"settings_fallback":       "Fallback Rule",
	"settings_error_pages":    "Error Pages",
	"settings_auth_enabled":   "Authentication Enabled",
	"settings_auth_disabled":  "Authentication Disabled",
	"settings_add_user":       "Add User",
	"settings_role":           "Role",
	"settings_role_admin":     "Admin",
	"settings_role_editor":    "Editor",
	"settings_role_viewer":    "Viewer",

	// Login
	"login_title":    "Login",
	"login_username": "Username",
	"login_password": "Password",
	"login_submit":   "Login",
	"login_setup":    "Create Admin Account",
	"login_error":    "Invalid credentials",

	// Messages
	"msg_reload_success":   "Configuration reloaded successfully",
	"msg_reload_error":     "Failed to reload configuration",
	"msg_validate_success": "Configuration is valid",
	"msg_validate_error":   "Configuration validation failed",
	"msg_backup_created":   "Backup created successfully",
	"msg_backup_restored":  "Backup restored successfully",
	"msg_import_success":   "Rules imported successfully",
	"msg_user_created":     "User created successfully",
	"msg_user_deleted":     "User deleted successfully",
}

// Czech translations
var czechTranslations = map[string]string{
	// General
	"app_name":     "CPM - Caddy Proxy Manager",
	"app_version":  "Verze",
	"save":         "Uložit",
	"cancel":       "Zrušit",
	"delete":       "Smazat",
	"edit":         "Upravit",
	"create":       "Vytvořit",
	"back":         "Zpět",
	"search":       "Hledat",
	"filter":       "Filtr",
	"loading":      "Načítání...",
	"success":      "Úspěch",
	"error":        "Chyba",
	"warning":      "Varování",
	"confirm":      "Potvrdit",
	"yes":          "Ano",
	"no":           "Ne",
	"actions":      "Akce",
	"settings":     "Nastavení",
	"logout":       "Odhlásit",
	"status":       "Stav",
	"domain":       "Doména",
	"modified":     "Upraveno",
	"more":         "další",
	"rules":        "pravidel",
	"days":         "dní",
	"today":        "Dnes",
	"never":        "Nikdy",
	"not_set":      "Nenastaveno",
	"about":        "O aplikaci",
	"build_date":   "Datum buildu",
	"about_description": "Webové rozhraní pro správu Caddy reverse proxy.",
	"valid_from":   "Platný od",
	"auto_scroll":  "Automaticky scrollovat",
	"username":     "Uživatelské jméno",
	"password":     "Heslo",
	"role":         "Role",
	"created":      "Vytvořeno",
	"last_login":   "Poslední přihlášení",

	// Navigation
	"nav_dashboard":    "Dashboard",
	"nav_sites":        "Proxy pravidla",
	"nav_snippets":     "Snippety",
	"nav_certificates": "Certifikáty",
	"nav_logs":         "Logy",
	"nav_settings":     "Nastavení",

	// Dashboard
	"dashboard_title":          "Dashboard",
	"dashboard_rules":          "Pravidel",
	"dashboard_certificates":   "Certifikátů",
	"dashboard_snippets":       "Snippetů",
	"dashboard_caddy_status":   "Stav Caddy",
	"dashboard_running":        "Běží",
	"dashboard_stopped":        "Zastaveno",
	"dashboard_recent_changes": "Poslední změny",
	"dashboard_no_changes":     "Žádné nedávné změny",
	"dashboard_alerts":         "Upozornění",
	"dashboard_no_alerts":      "Vše v pořádku",
	"dashboard_quick_actions":  "Rychlé akce",
	"dashboard_reload":         "Reload Caddy",
	"dashboard_validate":       "Validovat config",
	"dashboard_new_rule":       "Nové pravidlo",
	"dashboard_backup":         "Záloha",

	// Sites
	"sites_title":            "Proxy pravidla",
	"sites_new":              "Nové pravidlo",
	"sites_edit":             "Upravit pravidlo",
	"sites_delete":           "Smazat pravidlo",
	"sites_duplicate":        "Duplikovat pravidlo",
	"sites_empty":            "Žádná pravidla nenalezena",
	"sites_empty_title":      "Žádná proxy pravidla",
	"sites_empty_desc":       "Vytvořte první proxy pravidlo.",
	"sites_create":           "Vytvořit pravidlo",
	"sites_search":           "Hledat podle domény, IP nebo portu...",
	"sites_filter_tag":       "Filtrovat podle štítku",
	"sites_all_tags":         "Všechny štítky",
	"sites_domain":           "Doména(y)",
	"sites_target":           "Cíl",
	"sites_port":             "Port",
	"sites_ip":               "IP adresa",
	"sites_https_backend":    "HTTPS backend",
	"sites_internal":         "Pouze interní",
	"sites_websocket":        "WebSocket podpora",
	"sites_health_check":     "Health check cesta",
	"sites_timeout":          "Timeout (sekundy)",
	"sites_snippets":         "Snippety",
	"sites_tags":             "Štítky",
	"sites_extra_config":     "Extra konfigurace",
	"sites_raw_edit":         "Raw editace",
	"sites_form_edit":        "Formulář",
	"sites_preview":          "Náhled",
	"sites_confirm_delete":   "Opravdu chcete smazat toto pravidlo pro",
	"sites_created":          "Pravidlo úspěšně vytvořeno",
	"sites_updated":          "Pravidlo úspěšně aktualizováno",
	"sites_deleted":          "Pravidlo úspěšně smazáno",
	"sites_duplicated":       "Pravidlo úspěšně zduplikováno",
	"sites_from_template":    "Ze šablony",
	"sites_from_scratch":     "Od začátku",
	"sites_select_template":  "Vybrat šablonu",
	"sites_template_category": "Kategorie",
	"domain_config":          "Konfigurace domény",
	"backend_target":         "Backend cíl",
	"domains_hint":           "Oddělte více domén čárkou nebo mezerou",
	"tags_hint":              "Organizujte pravidla pomocí štítků oddělených čárkou",
	"advanced_options":       "Pokročilé možnosti",
	"extra_config_placeholder": "Dodatečné Caddy direktivy...",

	// Snippets
	"snippets_title":              "Správce snippetů",
	"snippets_description":        "Konfigurace znovupoužitelných Caddy snippetů, které lze importovat do proxy pravidel.",
	"snippets_cloudflare":         "Cloudflare DNS",
	"snippets_internal":           "Pouze interní",
	"snippets_security":           "Bezpečnostní hlavičky",
	"snippets_compression":        "Komprese",
	"snippets_rate_limit":         "Rate limit",
	"snippets_basic_auth":         "Basic autentizace",
	"snippets_enabled":            "Zapnuto",
	"snippets_disabled":           "Vypnuto",
	"snippets_enable_cloudflare":  "Povolit Cloudflare DNS Challenge",
	"snippets_enable_internal":    "Povolit omezení na interní síť",
	"snippets_enable_security":    "Povolit bezpečnostní hlavičky",
	"snippets_enable_compression": "Povolit kompresi",
	"snippets_enable_rate_limit":  "Povolit rate limiting",
	"snippets_use_env":            "Použít proměnnou prostředí CF_API_TOKEN",
	"snippets_api_token":          "API token (pokud nepoužíváte env)",
	"snippets_api_token_placeholder": "Zadejte Cloudflare API token",
	"snippets_allowed_networks":   "Povolené sítě (CIDR)",
	"snippets_networks_help":      "Jedna síť na řádek v CIDR notaci",
	"snippets_hsts_max_age":       "HSTS Max Age (sekundy)",
	"snippets_include_subdomains": "Zahrnout subdomény",
	"snippets_x_frame_options":    "X-Frame-Options",
	"snippets_referrer_policy":    "Referrer Policy",
	"snippets_hide_server":        "Skrýt Server hlavičku",
	"snippets_zstd":               "Zstd",
	"snippets_gzip":               "Gzip",
	"snippets_requests":           "Požadavků",
	"snippets_window":             "Okno (sekundy)",
	"snippets_users":              "Uživatelé",
	"snippets_add_user":           "Přidat uživatele",
	"snippets_username":           "Uživatelské jméno",
	"snippets_password":           "Heslo",

	// Certificates
	"certs_title":          "SSL certifikáty",
	"certs_count":          "certifikátů",
	"certs_domain":         "Doména",
	"certs_issuer":         "Vydavatel",
	"certs_expires":        "Vyprší",
	"certs_status":         "Stav",
	"certs_days_left":      "Zbývá dní",
	"certs_valid":          "Platný",
	"certs_expiring":       "Brzy vyprší (30d)",
	"certs_critical":       "Kritické (7d)",
	"certs_expired":        "Vypršel",
	"certs_delete":         "Vynutit obnovu",
	"certs_force_renew":    "Vynutit obnovu",
	"certs_confirm_delete": "Smazat certifikát pro vynucení obnovy pro",
	"certs_empty":          "Žádné certifikáty nenalezeny",
	"certs_empty_title":    "Žádné certifikáty",
	"certs_empty_desc":     "Certifikáty se zde zobrazí poté, co je Caddy získá.",
	"certs_about_title":    "O obnově certifikátů",
	"certs_about_desc":     "Caddy automaticky obnovuje certifikáty před vypršením. Použijte \"Vynutit obnovu\" pouze pokud potřebujete manuálně spustit obnovu (např. po změně DNS nastavení).",

	// Logs
	"logs_title":   "Caddy logy",
	"logs_lines":   "Řádků",
	"logs_refresh": "Obnovit",
	"logs_search":  "Hledat v logách...",
	"logs_stream":  "Živě",
	"logs_stop":    "Zastavit",
	"logs_empty":   "Žádné logy k dispozici",

	// Settings
	"settings_title":          "Nastavení",
	"settings_general":        "Obecné",
	"settings_backup":         "Zálohy",
	"settings_caddy":          "Caddy",
	"settings_users":          "Uživatelé",
	"settings_language":       "Jazyk",
	"settings_theme":          "Téma",
	"backup_restore":          "Záloha a obnova",
	"backup_description":      "Vytvořte nebo obnovte kompletní zálohu konfigurace Caddy.",
	"backup_create":           "Vytvořit zálohu",
	"backup_create_desc":      "Stáhněte ZIP soubor se všemi konfiguračními soubory.",
	"backup_download":         "Stáhnout zálohu",
	"backup_restore_title":    "Obnovit zálohu",
	"backup_restore_desc":     "Nahrajte ZIP soubor se zálohou pro obnovu konfigurace.",
	"backup_upload":           "Obnovit zálohu",
	"import_export":           "Import / Export pravidel",
	"import_export_desc":      "Exportujte pravidla jako JSON nebo importujte z jiné CPM instance.",
	"export_rules":            "Exportovat pravidla",
	"export_rules_desc":       "Stáhněte všechna proxy pravidla jako JSON soubor.",
	"export_json":             "Exportovat JSON",
	"import_rules":            "Importovat pravidla",
	"import_rules_desc":       "Importujte pravidla z JSON souboru.",
	"import_upload":           "Importovat pravidla",
	"skip_existing":           "Přeskočit existující pravidla",
	"fallback_rule":           "Fallback pravidlo",
	"fallback_description":    "Výchozí pravidlo pro neznámé domény (wildcard).",
	"fallback_not_found":      "Fallback pravidlo nenalezeno.",
	"error_pages":             "Chybové stránky",
	"error_pages_description": "Vlastní HTML stránky pro chybové odpovědi.",
	"user_management":         "Správa uživatelů",
	"enable_auth":             "Povolit autentizaci",
	"auth_disabled_warning":   "Autentizace je vypnuta. Kdokoliv má přístup k aplikaci.",
	"no_users_warning":        "Zatím nebyli vytvořeni žádní uživatelé. Vytvořte alespoň jednoho uživatele pro povolení autentizace.",
	"existing_users":          "Existující uživatelé",
	"add_user":                "Přidat nového uživatele",
	"create_user":             "Vytvořit uživatele",
	"confirm_delete_user":     "Smazat uživatele",
	"settings_backup_create":  "Vytvořit zálohu",
	"settings_backup_restore": "Obnovit zálohu",
	"settings_import":         "Import pravidel",
	"settings_export":         "Export pravidel",
	"settings_fallback":       "Fallback pravidlo",
	"settings_error_pages":    "Chybové stránky",
	"settings_auth_enabled":   "Autentizace zapnuta",
	"settings_auth_disabled":  "Autentizace vypnuta",
	"settings_add_user":       "Přidat uživatele",
	"settings_role":           "Role",
	"settings_role_admin":     "Administrátor",
	"settings_role_editor":    "Editor",
	"settings_role_viewer":    "Čtenář",

	// Login
	"login_title":    "Přihlášení",
	"login_username": "Uživatelské jméno",
	"login_password": "Heslo",
	"login_submit":   "Přihlásit",
	"login_setup":    "Vytvořit administrátorský účet",
	"login_error":    "Neplatné přihlašovací údaje",

	// Messages
	"msg_reload_success":   "Konfigurace úspěšně načtena",
	"msg_reload_error":     "Nepodařilo se načíst konfiguraci",
	"msg_validate_success": "Konfigurace je platná",
	"msg_validate_error":   "Validace konfigurace selhala",
	"msg_backup_created":   "Záloha úspěšně vytvořena",
	"msg_backup_restored":  "Záloha úspěšně obnovena",
	"msg_import_success":   "Pravidla úspěšně importována",
	"msg_user_created":     "Uživatel úspěšně vytvořen",
	"msg_user_deleted":     "Uživatel úspěšně smazán",
}
