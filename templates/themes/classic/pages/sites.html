<div class="page-header">
    <div class="page-header-title">
        <h1>ðŸ”€ {{t .Lang "sites_title"}}</h1>
        <span class="badge">{{.TotalSites}} {{t .Lang "rules"}}</span>
    </div>
    <div class="page-header-actions">
        <a href="/sites/new" class="btn btn-primary">
            âž• {{t .Lang "sites_new"}}
        </a>
    </div>
</div>

<!-- Filters -->
<div class="filters-bar">
    <div class="search-box">
        <input type="search" 
               name="search" 
               placeholder="{{t .Lang "sites_search"}}" 
               value="{{.Search}}"
               hx-get="/htmx/sites/list"
               hx-trigger="keyup changed delay:300ms"
               hx-target="#sites-list"
               hx-include="[name='tag']">
    </div>
    
    {{if .AllTags}}
    <select name="tag" 
            hx-get="/htmx/sites/list"
            hx-trigger="change"
            hx-target="#sites-list"
            hx-include="[name='search']">
        <option value="">{{t .Lang "sites_all_tags"}}</option>
        {{range .AllTags}}
        <option value="{{.}}" {{if eq . $.SelectedTag}}selected{{end}}>{{.}}</option>
        {{end}}
    </select>
    {{end}}
</div>

<!-- Sites List -->
<div id="sites-list" class="sites-grid">
    {{if .Sites}}
        {{range .Sites}}
        <div class="site-card">
            <div class="site-card-header">
                <div class="site-card-icon">{{.AccessIcon}}</div>
                <div class="site-card-title">
                    <h3>{{.PrimaryDomain}}</h3>
                    {{if gt (len .Domains) 1}}
                    <span class="text-muted">+{{sub (len .Domains) 1}} {{t $.Lang "more"}}</span>
                    {{end}}
                </div>
                <div class="site-card-badges">
                    {{if .IsWildcard}}
                    <span class="badge badge-wildcard" title="Wildcard TLS: *.{{.WildcardDomain}}">ðŸŒŸ</span>
                    {{end}}
                </div>
                <div class="site-card-actions">
                    <a href="/sites/{{.Filename}}/edit" class="btn btn-sm btn-secondary">{{t $.Lang "edit"}}</a>
                    <button class="btn btn-sm btn-danger"
                            hx-post="/sites/{{.Filename}}/delete"
                            hx-confirm="{{t $.Lang "sites_confirm_delete"}} {{.PrimaryDomain}}?">
                        {{t $.Lang "delete"}}
                    </button>
                </div>
            </div>
            
            <div class="site-card-body">
                <div class="site-card-info">
                    <span class="label">{{t $.Lang "sites_target"}}:</span>
                    <code>{{.TargetURL}}</code>
                </div>
                
                {{if .Tags}}
                <div class="site-card-tags">
                    {{range .Tags}}
                    <span class="tag">{{.}}</span>
                    {{end}}
                </div>
                {{end}}
                
                <div class="site-card-snippets">
                    {{if .IsWildcard}}
                    <span class="snippet-badge snippet-badge-tls">*.{{.WildcardDomain}}</span>
                    {{end}}
                    {{range .Snippets}}
                    <span class="snippet-badge">{{.}}</span>
                    {{end}}
                </div>
            </div>
            
            <div class="site-card-footer">
                <span class="text-muted text-sm">
                    {{t $.Lang "modified"}}: {{timeAgo .ModifiedAt}}
                </span>
            </div>
        </div>
        {{end}}
    {{else}}
        <div class="empty-state">
            <div class="empty-state-icon">ðŸ“­</div>
            <h3>{{t .Lang "sites_empty_title"}}</h3>
            <p>{{t .Lang "sites_empty_desc"}}</p>
            <a href="/sites/new" class="btn btn-primary">{{t .Lang "sites_create"}}</a>
        </div>
    {{end}}
</div>
